"use strict";$(function(){var t=$(".select-fypp"),e=t.select2(),n="",i=JSON.parse(localStorage.getItem("plotContent")),r=function(){i=JSON.parse(localStorage.getItem("plotContent")),console.log(i),i?i&&!i.promo?($("plot-search").hide(),$("plot-content").hide(),$("plot-not-promo").show(),$(".page__backdrop").css("opacity",.2)):i&&i.promo===!0&&($("plot-search").hide(),$("plot-content").show(),$("plot-not-promo").hide(),$(".page__content").html(i.infoHtml),$(".page__backdrop").css("opacity",.2)):($("plot-search").show(),$("plot-content").hide(),$("plot-not-promo").hide(),$(".page__backdrop").css("opacity",1))};r(),$.ajax({method:"GET",url:"http://electionself.fenwik.ru/api/geo_nodes/?no_parent=true",success:function(e){var n=[{id:0,cityId:null,text:"Выберите",selected:!0}];e.results.filter(function(t,e){t.name=t.name.replace(/город /,""),n.push({id:e+1,cityId:t.id,text:t.name})}),t.select2("destroy").empty().select2({data:n})}}),e.on("select2:select",function(e){var i=e.params.data;n+=""===n?e.params.data.text:", "+e.params.data.text,$(".page__plot span").html(n),i.cityId&&$.ajax({method:"GET",url:"http://electionself.fenwik.ru/api/geo_nodes/?parent="+i.cityId,success:function(e){if(console.log(e),e.results.length){var n=[{id:0,cityId:null,text:"Выберите",selected:!0}];e.results.filter(function(t,e){n.push({id:e+1,cityId:t.id,text:t.name})}),t.select2("destroy").empty().select2({data:n})}else t.prop("disabled",!0),$.ajax({method:"GET",url:"http://electionself.fenwik.ru/api/geo_nodes/"+i.cityId+"/precinct/",success:function(e){t.prop("disabled",!1),localStorage.setItem("plotContent",JSON.stringify(e)),r()}})}})}),$("[search-again]").on("click",function(){n="",$(".page__plot span").html("&mdash;"),$.ajax({method:"GET",url:"http://electionself.fenwik.ru/api/geo_nodes/?no_parent=true",success:function(e){var n=[{id:0,cityId:null,text:"Выберите",selected:!0}];e.results.filter(function(t,e){t.name=t.name.replace(/город /,""),n.push({id:e+1,cityId:t.id,text:t.name})}),t.select2("destroy").empty().select2({data:n}),localStorage.removeItem("plotContent"),r()}})})});var $document=$(document),$window=$(window),$body=$(document.body),BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS",this.platform=this.searchPlatform(navigator.userAgent)},searchString:function(t){for(var e=0;e<t.length;e++){var n=t[e].string,i=t[e].prop;if(this.versionSearchString=t[e].versionSearch||t[e].identity,n){if(n.indexOf(t[e].subString)!=-1)return t[e].identity}else if(i)return t[e].identity}},searchVersion:function(t){var e=t.indexOf(this.versionSearchString);if(e!=-1)return parseFloat(t.substring(e+this.versionSearchString.length+1))},searchPlatform:function(t){var e,n=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i,i=/Win|Mac|Linux/i;return e=1==n.test(t)?"mobile":1==i.test(t)?"desktop":"unknown platform"},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();