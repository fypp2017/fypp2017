"use strict";$(function(){if($("plot-content").length){var e=$(".select-fypp"),t=e.select2(),n="",i=JSON.parse(localStorage.getItem("plotContent")),o=function(){i=JSON.parse(localStorage.getItem("plotContent")),console.log(i),i?($("plot-search").hide(),$("plot-content").show(),i.promo?($('.page__promo[promo="true"]').show(),$('.page__promo[promo="false"]').hide()):($('.page__promo[promo="true"]').hide(),$('.page__promo[promo="false"]').show()),$(".page__content").html(i.infoHtml),$(".page__backdrop").css("opacity",.2)):($("plot-search").show(),$("plot-content").hide(),$(".page__backdrop").css("opacity",1))};o(),$.ajax({method:"GET",url:"https://electionself.fenwik.ru/api/precincts/?promo=true",success:function(e){console.log(e)}}),$.ajax({method:"GET",url:"https://electionself.fenwik.ru/api/geo_nodes/?no_parent=true",success:function(t){var n=[{id:0,cityId:null,text:"Выберите",selected:!0}];t.filter(function(e,t){e.name=e.name.replace(/город /,""),n.push({id:t+1,cityId:e.id,text:e.name})}),e.select2("destroy").empty().select2({data:n})}}),t.on("select2:select",function(t){var i=t.params.data;n+=""===n?t.params.data.text:", "+t.params.data.text,$(".page__plot span").html(n),i.cityId&&$.ajax({method:"GET",url:"https://electionself.fenwik.ru/api/geo_nodes/?parent="+i.cityId,success:function(t){if(console.log(t),t.length){var n=[{id:0,cityId:null,text:"Выберите",selected:!0}];t.filter(function(e,t){n.push({id:t+1,cityId:e.id,text:e.name})}),e.select2("destroy").empty().select2({data:n})}else e.prop("disabled",!0),$.ajax({method:"GET",url:"https://electionself.fenwik.ru/api/geo_nodes/"+i.cityId+"/precinct/",success:function(t){e.prop("disabled",!1),localStorage.setItem("plotContent",JSON.stringify(t)),o()}})}})}),$("[search-again]").on("click",function(){n="",$(".page__plot span").html("&mdash;"),$.ajax({method:"GET",url:"https://electionself.fenwik.ru/api/geo_nodes/?no_parent=true",success:function(t){var n=[{id:0,cityId:null,text:"Выберите",selected:!0}];t.filter(function(e,t){e.name=e.name.replace(/город /,""),n.push({id:t+1,cityId:e.id,text:e.name})}),e.select2("destroy").empty().select2({data:n}),localStorage.removeItem("plotContent"),o()}})})}}),$(function(){var e=$("#map");e.length&&$.ajax({method:"GET",url:"https://electionself.fenwik.ru/api/precincts/?promo=true",success:function(e){var t=e;ymaps.ready(function(){var e=new ymaps.Map("map",{center:[55.751574,37.573856],zoom:9},{searchControlProvider:"yandex#search"}),n=new ymaps.Clusterer({preset:"islands#invertedVioletClusterIcons",clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1});n.events.add(["mouseenter","mouseleave"],function(e){var t=e.get("target"),n=e.get("type");"undefined"!=typeof t.getGeoObjects?"mouseenter"==n?t.options.set("preset","islands#invertedPinkClusterIcons"):t.options.set("preset","islands#invertedVioletClusterIcons"):"mouseenter"==n?t.options.set("preset","islands#pinkIcon"):t.options.set("preset","islands#violetIcon")});for(var i=function(e,t){return{balloonContentHeader:"<h4>Участок №"+e.data.number+"</h4>",balloonContentBody:"<b>Адрес:</b> "+e.data.address,clusterCaption:"Участок <strong>№"+e.data.number+"</strong>"}},o=function(){return{preset:"islands#violetIcon"}},r=t,s=[],a=0,c=r.length;a<c;a++)null!==r[a].geoPosition&&(s[a]=new ymaps.Placemark([r[a].geoPosition.latitude,r[a].geoPosition.longitude],i(r[a],a),o()),n.add(s[a]));e.geoObjects.add(n),e.setBounds(n.getBounds(),{checkZoomRange:!0})})}})});var $document=$(document),$window=$(window),$body=$(document.body),BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS",this.platform=this.searchPlatform(navigator.userAgent)},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string,i=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(n.indexOf(e[t].subString)!=-1)return e[t].identity}else if(i)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(t!=-1)return parseFloat(e.substring(t+this.versionSearchString.length+1))},searchPlatform:function(e){var t,n=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i,i=/Win|Mac|Linux/i;return t=1==n.test(e)?"mobile":1==i.test(e)?"desktop":"unknown platform"},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();