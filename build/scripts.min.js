"use strict";$(function(){if($("plot-content").length){var e=$(".select-fypp"),t=e.select2(),o="",n=JSON.parse(localStorage.getItem("plotContent")),a=function(){n=JSON.parse(localStorage.getItem("plotContent")),n?($("plot-search").hide(),$("plot-content").show(),n.promo?($('[promo="true"]').show(),$('[promo="false"]').hide()):($('[promo="true"]').hide(),$('[promo="false"]').show()),$(".page__content").html(n.infoHtml),$(".page__backdrop").css("opacity",.2)):($("plot-search").show(),$("plot-content").hide(),$(".page__backdrop").css("opacity",1))};a(),$.ajax({method:"GET",url:"https://electionself.fenwik.ru/api/geo_nodes/?no_parent=true",success:function(t){var o=[{id:0,cityId:null,text:"Выберите",selected:!0}];t.filter(function(e,t){e.name=e.name.replace(/город /,""),o.push({id:t+1,cityId:e.id,text:e.name})}),e.select2("destroy").empty().select2({data:o})}}),t.on("select2:select",function(t){var n=t.params.data;o+=""===o?t.params.data.text:", "+t.params.data.text,$(".page__plot span").html(o),n.cityId&&$.ajax({method:"GET",url:"https://electionself.fenwik.ru/api/geo_nodes/?parent="+n.cityId,success:function(t){if(console.log(t),t.length){var o=[{id:0,cityId:null,text:"Выберите",selected:!0}];t.filter(function(e,t){o.push({id:t+1,cityId:e.id,text:e.name.replace(/&quot;/g,'"')})}),e.select2("destroy").empty().select2({data:o})}else e.prop("disabled",!0),$.ajax({method:"GET",url:"https://electionself.fenwik.ru/api/geo_nodes/"+n.cityId+"/precinct/",success:function(t){e.prop("disabled",!1),localStorage.setItem("plotContent",JSON.stringify(t)),a();var o=t.promo?"promo":"not_promo",n=database.ref("regions/"+o+"/"+t.id);n.update({id:t.id,number:t.data.number,address:t.data.address,votingAddress:t.data.votingAddress}).then(function(){n.once("value").then(function(e){e.val().foundOnce?n.update({foundOnce:e.val().foundOnce+1}):n.update({foundOnce:1})})})}})}})}),$("[search-again]").on("click",function(){o="",$(".page__plot span").html("&mdash;"),$.ajax({method:"GET",url:"https://electionself.fenwik.ru/api/geo_nodes/?no_parent=true",success:function(t){var o=[{id:0,cityId:null,text:"Выберите",selected:!0}];t.filter(function(e,t){e.name=e.name.replace(/город /,""),o.push({id:t+1,cityId:e.id,text:e.name.replace(/&quot;/g,'"')})}),e.select2("destroy").empty().select2({data:o}),localStorage.removeItem("plotContent"),a()}})})}}),$(function(){var e=$("#map");if(e.length){var t=void 0;t=$(".map_perm").length?"https://electionself.fenwik.ru/api/precincts/?promo=true&root_geo_node=121146":$(".map_kaliningrad").length?"https://electionself.fenwik.ru/api/precincts/?promo=true&root_geo_node=804276":$(".map_sovetsk").length?"https://electionself.fenwik.ru/api/precincts/?promo=true&root_geo_node=1839428":"https://electionself.fenwik.ru/api/precincts/?promo=true",$.ajax({method:"GET",url:t,success:function(e){var t=e;$(".map_sovetsk").length&&(t=t.filter(function(e){if("690"!==e.data.number&&"691"!==e.data.number)return e})),ymaps.ready(function(){var e=new ymaps.Map("map",{center:[0,0],zoom:9},{searchControlProvider:"yandex#search"}),o=new ymaps.Clusterer({preset:"islands#invertedVioletClusterIcons",clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1});o.events.add(["mouseenter","mouseleave"],function(e){var t=e.get("target"),o=e.get("type");"undefined"!=typeof t.getGeoObjects?"mouseenter"==o?t.options.set("preset","islands#invertedPinkClusterIcons"):t.options.set("preset","islands#invertedVioletClusterIcons"):"mouseenter"==o?t.options.set("preset","islands#pinkIcon"):t.options.set("preset","islands#violetIcon")});for(var n=function(e,t){return{balloonContentHeader:"<h4>Участок №"+e.data.number+"</h4>",balloonContentBody:"<b>Адрес:</b> "+e.data.address,clusterCaption:"Участок <strong>№"+e.data.number+"</strong>"}},a=function(){return{preset:"islands#violetIcon"}},r=t,s=[],i=0,c=r.length;i<c;i++)null!==r[i].geoPosition&&(s[i]=new ymaps.Placemark([r[i].geoPosition.latitude,r[i].geoPosition.longitude],n(r[i],i),a()),o.add(s[i]));e.geoObjects.add(o),e.setBounds(o.getBounds(),{checkZoomRange:!0})})}}),$("[search-again]").on("click",function(e){e.preventDefault(),localStorage.removeItem("plotContent"),location.href=$(this).attr("href")})}});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$document=$(document),$window=$(window),$body=$(document.body),searchParams=function(e){var t={};return e.replace(/\?/,"").split("&").forEach(function(e){t[e.split("=")[0]]=e.split("=")[1]}),t},getString=function(e){function t(e,n){return Array.isArray(e)?void e.forEach(function(e){t(e,n+"[]")}):null!==e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))?void Object.keys(e).forEach(function(o){t(e[o],n+"["+o+"]")}):void o.push(n+"="+e)}var o=[];return Object.keys(e).forEach(function(o){t(e[o],o)}),o.join("&")},userId="",database=firebase.database();$(function(){var e=searchParams(location.search);"vk"===e.app?VK.init(function(){console.log(e);var t=database.ref("users/vk/"+e.viewer_id);t.set()},function(){window.reload()},"5.68"):"ok"===e.app});